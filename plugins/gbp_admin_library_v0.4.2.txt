# Name: gbp_admin_library v0.4.2 
# Type: Library plugin
# GBP's Admin-Side Library
# Author: Graeme Porteous
# URL: http://rgbp.co.uk/projects/textpattern/gbp_admin_library/
# Recommended load order: 5

# .....................................................................
# This is a plugin for Textpattern CMS - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# .....................................................................

YToxMTp7czo0OiJuYW1lIjtzOjE3OiJnYnBfYWRtaW5fbGlicmFyeSI7czo2OiJhdXRob3Ii
O3M6MTU6IkdyYWVtZSBQb3J0ZW91cyI7czoxMDoiYXV0aG9yX3VyaSI7czo1NzoiaHR0cDov
L3JnYnAuY28udWsvcHJvamVjdHMvdGV4dHBhdHRlcm4vZ2JwX2FkbWluX2xpYnJhcnkvIjtz
Ojc6InZlcnNpb24iO3M6NToiMC40LjIiO3M6MTE6ImRlc2NyaXB0aW9uIjtzOjI0OiJHQlAn
cyBBZG1pbi1TaWRlIExpYnJhcnkiO3M6NDoiY29kZSI7czoyNzQwMToiLy8gQ29uc3RhbnRz
CmRlZmluZSgnZ2JwX3RhYicsICd0YWInKTsKZGVmaW5lKCdnYnBfaWQnLCAnaWQnKTsKCmNs
YXNzIEdCUFBsdWdpbiB7CgkvLyBJbnRlcm5hbCB2YXJpYWJsZXMKCXZhciAkcGx1Z2luX25h
bWU7Cgl2YXIgJHRpdGxlOwoJdmFyICRldmVudDsKCXZhciAkbWVzc2FnZSA9ICcnOwoJdmFy
ICR0YWJzID0gYXJyYXkoKTsKCXZhciAkYWN0aXZlX3RhYiA9IDA7Cgl2YXIgJHVzZV90YWJz
ID0gZmFsc2U7Cgl2YXIgJGdwID0gYXJyYXkoKTsKCXZhciAkcHJlZmVyZW5jZXMgPSBhcnJh
eSgpOwoJdmFyICRwZXJtaXNzaW9ucyA9ICcxLDIsMyw0LDUsNic7Cgl2YXIgJHdpemFyZF9r
ZXk7Cgl2YXIgJHdpemFyZF9pbnN0YWxsZWQgPSBmYWxzZTsKCgkvLyBDb25zdHJ1Y3RvcgoJ
ZnVuY3Rpb24gR0JQUGx1Z2luICgkdGl0bGUgPSAnJywgJGV2ZW50ID0gJycsICRwYXJlbnRf
dGFiID0gJycpIHsKCgkJZ2xvYmFsICR0eHBfY3VycmVudF9wbHVnaW47CgoJCS8vIFN0b3Jl
IGEgcmVmZXJlbmNlIHRvIHRoaXMgY2xhc3Mgc28gd2UgY2FuIGdldCBQSFAgNCB0byB3b3Jr
CgkJaWYgKHZlcnNpb25fY29tcGFyZShwaHB2ZXJzaW9uKCksICc1LjAuMCcsICc8JykpCgkJ
CWdsb2JhbCAkZ2JwX2FkbWluX2xpYl9yZWZzOyAkZ2JwX2FkbWluX2xpYl9yZWZzWyR0eHBf
Y3VycmVudF9wbHVnaW5dID0gJiR0aGlzOwoKCQkvLyBHZXQgdGhlIHBsdWdpbl9uYW1lIGZy
b20gdGhlIGdsb2JhbCB0eHBfY3VycmVudF9wbHVnaW4gdmFyaWFibGUKCQkkdGhpcy0+cGx1
Z2luX25hbWUgPSAkdHhwX2N1cnJlbnRfcGx1Z2luOwoKCQkvLyBXaGVuIG1ha2luZyBhIEdC
UEFkbWluVmlldyB0aGVyZSBtdXN0IGJlIGV2ZW50IGF0dHJpYnV0ZXMKCQkkdGhpcy0+ZXZl
bnQgPSAkZXZlbnQ7CgoJCS8vIEFkZCBwcml2cyBmb3IgdGhpcyBldmVudAoJCWdsb2JhbCAk
dHhwX3Blcm1pc3Npb25zOwoJCSRwZXJtcyA9IEAkdHhwX3Blcm1pc3Npb25zWyR0aGlzLT5w
ZXJtaXNzaW9uc107CgkJYWRkX3ByaXZzKCR0aGlzLT5ldmVudCwgKCRwZXJtcyA/ICRwZXJt
cyA6ICR0aGlzLT5wZXJtaXNzaW9ucykpOwoKCQlpZiAoQHR4cGludGVyZmFjZSA9PSAnYWRt
aW4nKSB7CgkJCS8vIFdlIGFyZSBhZG1pbi1zaWRlLgoKCQkJLy8gVGhlcmUgbXVzdCBiZSB0
aXRsZSBhbmQgZXZlbnQgYXR0cmlidXRlcwoJCQkkdGhpcy0+dGl0bGUgPSAkdGl0bGU7CgoJ
CQkvLyBUaGUgcGFyZW50X3RhYiBjYW4gb25seSBiZSBvbmUgb2YgZm91ciB0aGluZ3MsIG1h
a2Ugc3VyZSBpdCBpcwoJCQlpZiAoJGV2ZW50IEFORCAkdGl0bGUgQU5EICRwYXJlbnRfdGFi
IEFORCBhcnJheV9zZWFyY2goJHBhcmVudF90YWIsIGFycmF5KCdjb250ZW50JywgJ3ByZXNl
bnRhdGlvbicsICdhZG1pbicsICdleHRlbnNpb25zJykpID09PSBmYWxzZSkKCQkJCSRwYXJl
bnRfdGFiID0gJ2V4dGVuc2lvbnMnOwoKCQkJLy8gU2V0IHVwIHRoZSBnZXQtcG9zdCBhcnJh
eQoJCQkkdGhpcy0+Z3AgPSBhcnJheV9tZXJnZShhcnJheSgnZXZlbnQnLCBnYnBfdGFiKSwg
JHRoaXMtPmdwKTsKCgkJCS8vIENoZWNrIGlmIG91ciBldmVudCBpcyBhY3RpdmUsIGlmIHNv
IGNhbGwgcHJlbG9hZCgpCgkJCWlmIChncHMoJ2V2ZW50JykgPT0gJGV2ZW50KSB7CgoJCQkJ
JHRoaXMtPmxvYWRfcHJlZmVyZW5jZXMoKTsKCgkJCQkkdGhpcy0+cHJlbG9hZCgpOwoKCQkJ
CS8vIFRhYnMgc2hvdWxkIGJlIGxvYWRlZCBieSBub3cKCQkJCWlmICgkcGFyZW50X3RhYiAm
JiAkdGhpcy0+dXNlX3RhYnMpIHsKCgkJCQkJZm9yZWFjaCAoYXJyYXlfa2V5cygkdGhpcy0+
dGFicykgYXMgJGtleSkgewoJCQkJCQkkdGFiID0gJiR0aGlzLT50YWJzWyRrZXldOwoJCQkJ
CQkkdGFiLT5waHBfNF9maXgoKTsKCQkJCQkJaWYgKGlzX2EoJHRhYiwgJ0dCUFdpemFyZFRh
YlZpZXcnKSkgewoJCQkJCQkJJHRoaXMtPndpemFyZF9rZXkgPSAka2V5OwoJCQkJCQkJJHRo
aXMtPndpemFyZF9pbnN0YWxsZWQgPSAkdGFiLT5pbnN0YWxsZWQoKTsKCQkJCQkJfQoJCQkJ
CX0KCgkJCQkJaWYgKCEkdGhpcy0+d2l6YXJkX2luc3RhbGxlZCAmJiAkdGhpcy0+d2l6YXJk
X2tleSkKCQkJCQkJJHRoaXMtPmFjdGl2ZV90YWIgPSAkdGhpcy0+d2l6YXJkX2tleTsKCgkJ
CQkJLy8gTGV0IHRoZSBhY3RpdmVfdGFiIGtub3cgaXQncyBhY3RpdmUgYW5kIGNhbGwgaXQn
cyBwcmVsb2FkKCkKCQkJCQkkdGFiID0gJiR0aGlzLT50YWJzWyR0aGlzLT5hY3RpdmVfdGFi
XTsKCQkJCQkkdGFiLT5pc19hY3RpdmUgPSAxOwoJCQkJCSR0YWItPnByZWxvYWQoKTsKCQkJ
CX0KCQkJfQoKCQkJLy8gQ2FsbCB0eHAgZnVuY3Rpb25zIHRvIHJlZ2lzdGVyIHRoaXMgcGx1
Z2luCgkJCWlmICgkcGFyZW50X3RhYikgewoJCQkJcmVnaXN0ZXJfdGFiKCRwYXJlbnRfdGFi
LCAkZXZlbnQsICR0aXRsZSk7CgkJCQlyZWdpc3Rlcl9jYWxsYmFjayhhcnJheSgmJHRoaXMs
ICdyZW5kZXInKSwgJGV2ZW50LCBudWxsLCAwKTsKCQkJfQoJCX0KCQlpZiAoQHR4cGludGVy
ZmFjZSA9PSAncHVibGljJykKCQkJJHRoaXMtPmxvYWRfcHJlZmVyZW5jZXMoKTsKCX0KCglm
dW5jdGlvbiBsb2FkX3ByZWZlcmVuY2VzICgpIHsKCQkvKgoJCUdyYWIgYW5kIHN0b3JlIGFs
bCBwcmVmZXJlbmNlcyB3aXRoIGV2ZW50IG1hdGNoaW5nIHRoaXMgcGx1Z2luLCBjb21iaW5l
IGdicF9wYXJ0aWFsCgkJcm93cyBhbmQgZGVjb2RlIHRoZSB2YWx1ZSBpZiBpdCdzIG9mIGN1
c3RvbSB0eXBlLgoJCSovCgkJZ2xvYmFsICRwcmVmczsKCgkJLy8gT3ZlcnJpZGUgdGhlIGRl
ZmF1bHQgdmFsdWVzIGlmIHRoZSBwcmVmcyBoYXZlIGJlZW4gc3RvcmVkIGluIHRoZSBwcmVm
ZXJlbmNlcyB0YWJsZS4KCQkkcHJlZmVyZW5jZXMgPSBzYWZlX3Jvd3MoIm5hbWUsIGh0bWwg
YXMgdHlwZSIsCgkJJ3R4cF9wcmVmcycsICJldmVudCA9ICd7JHRoaXMtPmV2ZW50fScgQU5E
IGh0bWwgPD4gJ2dicF9wYXJ0aWFsJyIpOwoKCQkvLyBBZGQgdGhlIGRlZmF1bHQgcHJlZmVy
ZW5jZXMgd2hpY2ggYXJlbid0IHNhdmVkIGluIHRoZSBkYiBidXQgZGVmaW5lZCBpbiB0aGUg
cGx1Z2luJ3Mgc291cmNlLgoJCWZvcmVhY2ggKCR0aGlzLT5wcmVmZXJlbmNlcyBhcyAka2V5
ID0+ICRwcmVmKSB7CgkJCSRkYl9wcmVmID0gYXJyYXkoJ25hbWUnID0+ICR0aGlzLT5wbHVn
aW5fbmFtZS4nXycuJGtleSwgJ3R5cGUnID0+ICRwcmVmWyd0eXBlJ10pOwoJCQlpZiAoYXJy
YXlfc2VhcmNoKCRkYl9wcmVmLCAkcHJlZmVyZW5jZXMpID09PSBmYWxzZSkKCQkJCSRwcmVm
ZXJlbmNlc1tdID0gJGRiX3ByZWYgKyBhcnJheSgnZGVmYXVsdF92YWx1ZScgPT4gJHByZWZb
J3ZhbHVlJ10pOwoJCX0KCgkJZm9yZWFjaCAoJHByZWZlcmVuY2VzIGFzICRuYW1lID0+ICRw
cmVmKSB7CgkJCS8vIEV4dHJhY3QgdGhlIG5hbWUgYW5kIHR5cGUuCgkJCWV4dHJhY3QoJHBy
ZWYpOwoKCQkJLy8gVGhlIGJhc2UgbmFtZSB3aGljaCBnYnBfcGFydGlhbCBwcmVmZXJlbmNl
cyBjb3VsZCBzaGFyZS4KCQkJJGJhc2VfbmFtZSA9ICRuYW1lOwoKCQkJLy8gQ29tYmluZSB0
aGUgZXh0ZW5kZWQgcHJlZmVyZW5jZXMsIHdoaWNoIGdvIG92ZXIgdHdvIHJvd3MgaW50byBv
bmUgcHJlZmVyZW5jZS4KCQkJJGkgPSAwOyAkdmFsdWUgPSAnJzsKCQkJd2hpbGUgKGFycmF5
X2tleV9leGlzdHMoJG5hbWUsICRwcmVmcykpIHsKCQkJCSR2YWx1ZSAuPSAkcHJlZnNbJG5h
bWVdOwoJCQkJdW5zZXQoJHByZWZzWyRuYW1lXSk7CgkJCQkvLyBVcGRhdGUgbmFtZSBmb3Ig
dGhlIG5leHQgYXJyYXlfa2V5X2V4aXN0cyBjaGVjay4KCQkJCSRuYW1lID0gJGJhc2VfbmFt
ZS4nXycuKyskaTsKCQkJfQoKCQkJLy8gSWYgdGhlcmUgaXMgbm8gdmFsdWUgdGhlbiByZXZl
cnQgdG8gdGhlIGRlZmF1bHQgdmFsdWUgaWYgaXQgZXhpc3RzLgoJCQlpZiAoKCEkdmFsdWUg
fHwgKEAhJHZhbHVlWzBdICYmIGNvdW50KCR2YWx1ZSkgPD0gMSkpICYmIGlzc2V0KCRkZWZh
dWx0X3ZhbHVlKSkKCQkJCSR2YWx1ZSA9ICRkZWZhdWx0X3ZhbHVlOwoKCQkJLy8gRWxzZSBp
ZiB0aGlzIGEgY3VzdG9tIHR5cGUgKEUuZy4gZ2JwX3NlcmlhbGl6ZWQgT1IgZ2JwX2FycmF5
X3RleHQpCgkJCS8vIGNhbGwgaXQncyBkYl9nZXQgbWV0aG9kIHRvIGRlY29kZSBpdCdzIHZh
bHVlLgoJCQllbHNlIGlmIChpc19jYWxsYWJsZShhcnJheSgmJHRoaXMsICR0eXBlKSkpCgkJ
CQkkdmFsdWUgPSBjYWxsX3VzZXJfZnVuYyhhcnJheSgmJHRoaXMsICR0eXBlKSwgJ2RiX2dl
dCcsICR2YWx1ZSk7CgoJCQkvLyBSZS1zZXQgdGhlIGNvbWJpbmVkIGFuZCBkZWNvZGVkIHZh
bHVlIHRvIHRoZSBnbG9iYWwgcHJlZnMgYXJyYXkuCgkJCSRwcmVmc1skYmFzZV9uYW1lXSA9
ICR2YWx1ZTsKCgkJCS8vIElmIHRoZSBwcmVmZXJlbmNlIGV4aXN0cyBpbiBvdXIgcHJlZmVy
ZW5jZSBhcnJheSBzZXQgdGhlIG5ldyB2YWx1ZSBhbmQgY29ycmVjdCB0eXBlLgoJCQkkYmFz
ZV9uYW1lID0gc3Vic3RyKCRiYXNlX25hbWUsIHN0cmxlbigkdGhpcy0+cGx1Z2luX25hbWUu
J18nKSk7CgkJCWlmIChhcnJheV9rZXlfZXhpc3RzKCRiYXNlX25hbWUsICR0aGlzLT5wcmVm
ZXJlbmNlcykpCgkJCQkkdGhpcy0+cHJlZmVyZW5jZXNbJGJhc2VfbmFtZV0gPSBhcnJheSgn
dmFsdWUnID0+ICR2YWx1ZSwgJ3R5cGUnID0+ICR0eXBlKTsKCQl9Cgl9CgoJZnVuY3Rpb24g
c2V0X3ByZWZlcmVuY2UgKCRrZXksICR2YWx1ZSwgJHR5cGUgPSAnJykgewoJCWdsb2JhbCAk
cHJlZnMsICR0eHBfY3VycmVudF9wbHVnaW47CgoJCS8vIElmIHRoZSBwbHVnaW5fbmFtZSBv
ciBldmVudCBpc24ndCBzZXQgaXMgaXQgc2FmZSB0byBhc3N1bWUKCQkvLyAkdHhwX2N1cnJl
bnRfcGx1Z2luIGFuZCBncHMoJ2V2ZW50JykgYXJlIGNvcnJlY3Q/CgkJJHBsdWdpbiA9ICgk
dGhpcy0+cGx1Z2luX25hbWUpID8gJHRoaXMtPnBsdWdpbl9uYW1lIDogJHR4cF9jdXJyZW50
X3BsdWdpbjsKCQkkZXZlbnQgPSAoJHRoaXMtPmV2ZW50KSA/ICR0aGlzLT5ldmVudCA6IGdw
cygnZXZlbnQnKTsKCgkJLy8gU2V0IHNvbWUgc3RhbmRhcmQgZGIgZmllbGRzCgkJJGJhc2Vf
bmFtZSA9ICRwbHVnaW4uJ18nLiRrZXk7CgkJJG5hbWUgPSAkYmFzZV9uYW1lOwoKCQkvLyBJ
ZiBhIHR5cGUgaGFzbid0IGJlZW4gc3BlY2lmaWVkIHRoZW4gbG9vayB0aGUga2V5IHVwIGlu
IG91ciBwcmVmZXJlbmNlcy4KCQkvLyBFbHNlIGFzc3VtZSBpdCdzIHR5cGUgaXMgJ3RleHRf
aW5wdXQnLgoJCWlmIChlbXB0eSgkdHlwZSkgJiYgYXJyYXlfa2V5X2V4aXN0cygka2V5LCAk
dGhpcy0+cHJlZmVyZW5jZXMpKQoJCQkkdHlwZSA9ICR0aGlzLT5wcmVmZXJlbmNlc1ska2V5
XVsndHlwZSddOwoJCWVsc2UgaWYgKGVtcHR5KCR0eXBlKSkKCQkJJHR5cGUgPSAndGV4dF9p
bnB1dCc7CgoJCS8vIFNldCB0aGUgbmV3IHZhbHVlIHRvIHRoZSBnbG9iYWwgcHJlZnMgYXJy
YXkgYW5kIGlmIHRoZSBwcmVmZXJlbmNlIGV4aXN0cwoJCS8vIHRvIG91ciBvd24gcHJlZmVy
ZW5jZSBhcnJheS4KCQkkcHJlZnNbJG5hbWVdID0gJHZhbHVlOwoJCWlmIChhcnJheV9rZXlf
ZXhpc3RzKCRrZXksICR0aGlzLT5wcmVmZXJlbmNlcykpCgkJCSR0aGlzLT5wcmVmZXJlbmNl
c1ska2V5XSA9IGFycmF5KCd2YWx1ZScgPT4gJHZhbHVlLCAndHlwZScgPT4gJHR5cGUpOwoK
CQkvLyBJZiB0aGlzIHByZWZlcmVuY2UgaGFzIGEgY3VzdG9tIHR5cGUgKEUuZy4gZ2JwX3Nl
cmlhbGl6ZWQgT1IgZ2JwX2FycmF5X3RleHQpCgkJLy8gY2FsbCBpdCdzIGRiX3NldCBtZXRo
b2QgdG8gZW5jb2RlIHRoZSB2YWx1ZS4KCQlpZiAoaXNfY2FsbGFibGUoYXJyYXkoJiR0aGlz
LCAkdHlwZSkpKQoJCQkkdmFsdWUgPSBjYWxsX3VzZXJfZnVuYyhhcnJheSgmJHRoaXMsICR0
eXBlKSwgJ2RiX3NldCcsICR2YWx1ZSk7CgoJCS8vIEl0IGlzIHBvc3NpYmxlIHRvIGxlYXZl
IG9sZCAnZ2JwX3BhcnRpYWwnIHBlcmZlcmVuY2VzIHdoZW4gcmVkdWNpbmcgdGhlCgkJLy8g
bGVuZ2h0IG9mIGEgcHJlZmVyZW5jZS4gUmVtb3ZlIHRoZW0gYWxsLgoJCSR0aGlzLT5yZW1v
dmVfcHJlZmVyZW5jZSgkbmFtZSk7CgoJCS8vIE1ha2Ugc3VyZSBwcmVmZXJlbmNlcyB3aGlj
aCBlcXVhbCBOVUxMIGFyZSBzYXZlZAoJCWlmIChlbXB0eSgkdmFsdWUpKQoJCQlzZXRfcHJl
ZigkbmFtZSwgJycsICRldmVudCwgMiwgJHR5cGUpOwoKCQkkaSA9IDA7ICR2YWx1ZSA9IGRv
U2xhc2goJHZhbHVlKTsKCQkvLyBMaW1pdCBwcmVmZXJlbmNlIHRvIGFwcHJveGltYXRseSA0
S2Igb2YgZGF0YS4gSSBob3BlIHRoaXMgd2lsbCBiZSBlbm91Z2gKCQl3aGlsZSAoc3RybGVu
KCR2YWx1ZSkgJiYgJGkgPCAxNikgewoJCQkvLyBHcmFiIHRoZSBmaXJzdCAyNTUgY2hhcnMg
ZnJvbSB0aGUgdmFsdWUgYW5kIHN0cmlwIGFueSBiYWNrd2FyZCBzbGFzaGVzIHdoaWNoCgkJ
CS8vIGNhdXNlIHRoZSBTUUwgdG8gYnJlYWsuCgkJCSR2YWx1ZV9zZWdtZW50ID0gcnRyaW0o
c3Vic3RyKCR2YWx1ZSwgMCwgMjU1KSwgJ1xcJyk7CgoJCQkvLyBTZXQgdGhlIHByZWZlcmVu
Y2UgYW5kIHVwZGF0ZSBuYW1lIGZvciB0aGUgbmV4dCBhcnJheV9rZXlfZXhpc3RzIGNoZWNr
LgoJCQlzZXRfcHJlZigkbmFtZSwgJHZhbHVlX3NlZ21lbnQsICRldmVudCwgMiwgKCRpID8g
J2dicF9wYXJ0aWFsJyA6ICR0eXBlKSk7CgkJCSRuYW1lID0gJGJhc2VfbmFtZS4nXycuKysk
aTsKCgkJCS8vIFJlbW92ZSB0aGUgc2VnbWVudCBvZiB0aGUgdmFsdWUgd2hpY2ggaGFzIGJl
ZW4gc2F2ZWQuCgkJCSR2YWx1ZSA9IHN1YnN0cl9yZXBsYWNlKCR2YWx1ZSwgJycsIDAsIHN0
cmxlbigkdmFsdWVfc2VnbWVudCkpOwoJCX0KCX0KCglmdW5jdGlvbiByZW1vdmVfcHJlZmVy
ZW5jZSAoJGtleSkgewoJCSRldmVudCA9ICR0aGlzLT5ldmVudDsKCQlzYWZlX2RlbGV0ZSgn
dHhwX3ByZWZzJywgImV2ZW50ID0gJyRldmVudCcgQU5EICgobmFtZSBMSUtFICcka2V5Jykg
T1IgKG5hbWUgTElLRSAneyRrZXl9XyUnIEFORCBodG1sID0gJ2dicF9wYXJ0aWFsJykpIik7
Cgl9CgoJZnVuY3Rpb24gZ2JwX3NlcmlhbGl6ZWQgKCRzdGVwLCAkdmFsdWUsICRpdGVtID0g
JycpIHsKCQlzd2l0Y2ggKHN0cnRvbG93ZXIoJHN0ZXApKSB7CgkJCWRlZmF1bHQ6CgkJCWNh
c2UgJ3VpX2luJzoKCQkJCWlmICghaXNfYXJyYXkoJHZhbHVlKSkgJHZhbHVlID0gYXJyYXko
JHZhbHVlKTsKCQkJCXJldHVybiB0ZXh0X2lucHV0KCRpdGVtLCBpbXBsb2RlKCcsJywgJHZh
bHVlKSwgNTApOwoJCQlicmVhazsKCQkJY2FzZSAndWlfb3V0JzoKCQkJCXJldHVybiBleHBs
b2RlKCcsJywgJHZhbHVlKTsKCQkJYnJlYWs7CgkJCWNhc2UgJ2RiX3NldCc6CgkJCQlyZXR1
cm4gc2VyaWFsaXplKCR2YWx1ZSk7CgkJCWJyZWFrOwoJCQljYXNlICdkYl9nZXQnOgoJCQkJ
cmV0dXJuIHVuc2VyaWFsaXplKCR2YWx1ZSk7CgkJCWJyZWFrOwoJCX0KCQlyZXR1cm4gJyc7
Cgl9CgoJZnVuY3Rpb24gZ2JwX2FycmF5X3RleHQgKCRzdGVwLCAkdmFsdWUsICRpdGVtID0g
JycpIHsKCQlzd2l0Y2ggKHN0cnRvbG93ZXIoJHN0ZXApKSB7CgkJCWRlZmF1bHQ6CgkJCWNh
c2UgJ3VpX2luJzoKCQkJCWlmICghaXNfYXJyYXkoJHZhbHVlKSkgJHZhbHVlID0gYXJyYXko
JHZhbHVlKTsKCQkJCXJldHVybiB0ZXh0X2lucHV0KCRpdGVtLCBpbXBsb2RlKCcsJywgJHZh
bHVlKSwgNTApOwoJCQlicmVhazsKCQkJY2FzZSAndWlfb3V0JzoKCQkJCXJldHVybiBleHBs
b2RlKCcsJywgJHZhbHVlKTsKCQkJYnJlYWs7CgkJCWNhc2UgJ2RiX3NldCc6CgkJCQlyZXR1
cm4gaW1wbG9kZSgnLCcsICR2YWx1ZSk7CgkJCWJyZWFrOwoJCQljYXNlICdkYl9nZXQnOgoJ
CQkJcmV0dXJuIGV4cGxvZGUoJywnLCAkdmFsdWUpOwoJCQlicmVhazsKCQl9CgkJcmV0dXJu
ICcnOwoJfQoKCWZ1bmN0aW9uICZhZGRfdGFiICgkdGFiLCAkaXNfZGVmYXVsdCA9IE5VTEwp
IHsKCgkJLy8gQ2hlY2sgdG8gc2VlIGlmIHRoZSB0YWIgaXMgYWN0aXZlCgkJaWYgKCgkaXNf
ZGVmYXVsdCAmJiAhZ3BzKGdicF90YWIpKSB8fCAoZ3BzKGdicF90YWIpID09ICR0YWItPmV2
ZW50KSkKCQkJJHRoaXMtPmFjdGl2ZV90YWIgPSBjb3VudCgkdGhpcy0+dGFicyk7CgoJCWlm
IChpc19hKCR0YWIsICdHQlBXaXphcmRUYWJWaWV3JykpIHsKCQkJJHRhYi0+cGFyZW50ID0g
JiR0aGlzOwoKCQkJLy8gV2l6YXJkIHJvdXRpbmVzCgkJCSRzdGVwID0gZ3BzKCdzdGVwJyk7
CgkJCWlmIChpbl9hcnJheSgkc3RlcCwgYXJyYXkoJ3NldHVwJywgJ2NsZWFudXAnKSkpIHsK
CQkJCSRpbnN0YWxsYXRpb25fc3RlcHMgPSAoJHN0ZXAgPT0gJ3NldHVwJykKCQkJCQk/IGFy
cmF5X2tleXMoJHRhYi0+aW5zdGFsbGF0aW9uX3N0ZXBzKQoJCQkJCTogYXJyYXlfcmV2ZXJz
ZShhcnJheV9rZXlzKCR0YWItPmluc3RhbGxhdGlvbl9zdGVwcykpOwoJCQkJZm9yZWFjaCAo
JGluc3RhbGxhdGlvbl9zdGVwcyBhcyAka2V5KSB7CgkJCQkJJGZ1bmN0aW9uID0gYXJyYXko
JiR0YWIsICRzdGVwLidfJy4ka2V5KTsKCQkJCQlpZiAoaXNfY2FsbGFibGUoJGZ1bmN0aW9u
KSkgewoJCQkJCQkkb3B0aW9uYWwgPSBAJHRhYi0+aW5zdGFsbGF0aW9uX3N0ZXBzWyRrZXld
WydvcHRpb25hbCddOwoJCQkJCQlpZiAoKCRvcHRpb25hbCAmJiBncHMoJ29wdGlvbmFsXycu
JGtleSkpIHx8ICEkb3B0aW9uYWwpCgkJCQkJCQljYWxsX3VzZXJfZnVuYygkZnVuY3Rpb24p
OwoJCQkJCQllbHNlCgkJCQkJCQkkdGFiLT5hZGRfcmVwb3J0X2l0ZW0oJHRhYi0+aW5zdGFs
bGF0aW9uX3N0ZXBzWyRrZXldWyRzdGVwXSwgJ3NraXBwZWQnKTsKCQkJCQl9CgkJCQl9CgkJ
CX0KCQl9CgoJCS8vIFN0b3JlIHRoZSB0YWIKCQkkdGhpcy0+dGFic1tdID0gJHRhYjsKCgkJ
Ly8gV2UndmUgZ290IGEgdGFiLCBsZXRzIGFzc3VtZSB3ZSB3YW50IHRvIHVzZSBpdAoJCSR0
aGlzLT51c2VfdGFicyA9IHRydWU7CgoJCXJldHVybiAkdGhpczsKCX0KCglmdW5jdGlvbiBw
cmVsb2FkICgpIHsKCQkvLyBPdmVycmlkZSB0aGlzIGZ1bmN0aW9uIGlmIHlvdSByZXF1aXJl
IHN1YiB0YWJzLgoJfQoKCWZ1bmN0aW9uIHJlbmRlciAoKSB7CgoJCS8vIHJlbmRlcigpIGdl
dHMgY2FsbGVkIGJlY2F1c2UgaXQgaXMgc3BlY2lmaWVkIGluIHR4cCdzIHJlZ2lzdGVyX2Nh
bGxiYWNrKCkKCgkJLy8gQWZ0ZXIgYSBjYWxsYmFjayB3ZSBsb3NlIHRyYWNrIG9mIHRoZSBj
dXJyZW50IHBsdWdpbiBpbiBQSFAgNAoJCWdsb2JhbCAkdHhwX2N1cnJlbnRfcGx1Z2luOwoJ
CSR0eHBfY3VycmVudF9wbHVnaW4gPSAkdGhpcy0+cGx1Z2luX25hbWU7CgoJCSR0aGlzLT5y
ZW5kZXJfaGVhZGVyKCk7CgkJJHRoaXMtPm1haW4oKTsKCgkJaWYgKCR0aGlzLT51c2VfdGFi
cykgewoKCQkJJHRoaXMtPnJlbmRlcl90YWJzKCk7CgkJCSR0aGlzLT5yZW5kZXJfdGFiX21h
aW4oKTsKCQl9CgoJCSR0aGlzLT5yZW5kZXJfZm9vdGVyKCk7CgkJJHRoaXMtPmVuZCgpOwoJ
fQoKCWZ1bmN0aW9uIHJlbmRlcl9oZWFkZXIgKCkgewoKCQkvLyBSZW5kZXIgdGhlIHBhZ2V0
b3AsIGEgdHhwIGZ1bmN0aW9uCgkJcGFnZXRvcCgkdGhpcy0+dGl0bGUsICR0aGlzLT5tZXNz
YWdlKTsKCgkJLy8gT25jZSBhIG1lc3NhZ2UgaGFzIGJlZW4gdXNlZCB3ZSBkaXNjYXJkIGl0
CgkJJHRoaXMtPm1lc3NhZ2UgPSAnJzsKCX0KCglmdW5jdGlvbiByZW5kZXJfdGFicyAoKSB7
CgkJLy8gVGhpcyB0YWJsZSwgd2hpY2ggY29udGFpbnMgdGhlIHRhZ3MsIHdpbGwgaGF2ZSB0
byBiZSBjaGFuZ2VkIGlmIGFueSBpbXByb3ZlbWVudHMKCQkvLyBoYXBwZW4gdG8gdGhlIGFk
bWluIGludGVyZmFjZQoJCSRvdXRbXSA9ICc8ZGl2IGlkPSInLiR0aGlzLT5wbHVnaW5fbmFt
ZS4nX2NvbnRyb2wiIGNsYXNzPSJ0eHAtY29udHJvbC1wYW5lbCI+JzsKCQkkb3V0W10gPSAn
PHAgY2xhc3M9InR4cC1idXR0b25zIj4nOwoJCSRzdHlsZSA9ICcnOwoKCQkvLyBGb3JjZSB0
aGUgd2l6YXJkIHRvIGJlIHRoZSBvbmx5IHRhYiBpZiB0aGUgcGx1Z2luIGlzbid0IGluc3Rh
bGxlZAoJCWlmICgkdGhpcy0+d2l6YXJkX2luc3RhbGxlZCB8fCAhJHRoaXMtPndpemFyZF9r
ZXkpCgkJCWZvcmVhY2ggKGFycmF5X2tleXMoJHRoaXMtPnRhYnMpIGFzICRrZXkpIHsKCQkJ
CS8vIFJlbmRlciBlYWNoIHRhYiBidXQga2VlcCBhIHJlZmVyZW5jZSB0byB0aGUgdGFiIHNv
IGFueSBjaGFuZ2VzIG1hZGUgYXJlIHN0b3JlZAoJCQkJJHRhYiA9ICYkdGhpcy0+dGFic1sk
a2V5XTsKCQkJCSRvdXRbXSA9ICR0YWItPnJlbmRlcl90YWIoKTsKCQkJCSRmbiA9IGFycmF5
KCYkdGFiICwgJ2dldF9jYW52YXNfc3R5bGUnKTsKCQkJCWlmIChpc19jYWxsYWJsZSgkZm4p
KSB7CgkJCQkJJHJlcyA9IGNhbGxfdXNlcl9mdW5jKCRmbik7CgkJCQkJJHN0eWxlID0gKGZh
bHNlIT09JHJlcykgPyAkcmVzIDogJHN0eWxlIDsKCQkJCX0KCQkJfQoJCWVsc2UgewoJCQkk
dGFiID0gJiR0aGlzLT50YWJzWyR0aGlzLT53aXphcmRfa2V5XTsKCQkJJG91dFtdID0gJHRh
Yi0+cmVuZGVyX3RhYigpOwoJCQkkZm4gPSBhcnJheSgmJHRhYiAsICdnZXRfY2FudmFzX3N0
eWxlJyk7CgkJCWlmIChpc19jYWxsYWJsZSgkZm4pKSB7CgkJCQkkcmVzID0gY2FsbF91c2Vy
X2Z1bmMoJGZuKTsKCQkJCSRzdHlsZSA9IChmYWxzZSE9PSRyZXMpID8gJHJlcyA6ICRzdHls
ZSA7CgkJCX0KCQl9CgoJCSRvdXRbXSA9ICc8L3A+JzsKCQkkb3V0W10gPSAnPC9kaXY+PGRp
dj4nOwoKCQllY2hvIGpvaW4oJycsICRvdXQpOwoJfQoKCWZ1bmN0aW9uIG1haW4gKCkgewoJ
CS8vIE92ZXJyaWRlIHRoaXMgZnVuY3Rpb24KCX0KCglmdW5jdGlvbiByZW5kZXJfdGFiX21h
aW4gKCkgewoKCQkvLyBDYWxsIG1haW4oKSBmb3IgdGhlIGFjdGl2ZV90YWIKCQkkdGFiID0g
JiR0aGlzLT50YWJzWyR0aGlzLT5hY3RpdmVfdGFiXTsKCQlpZiAoKCR0aGlzLT53aXphcmRf
aW5zdGFsbGVkIHx8ICEkdGhpcy0+d2l6YXJkX2tleSB8fCAkdGFiLT5ldmVudCA9PSAnd2l6
YXJkJykgJiYgaGFzX3ByaXZzKCR0aGlzLT5ldmVudC4nLicuJHRhYi0+ZXZlbnQpKQoJCQkk
dGFiLT5tYWluKCk7CgkJZWxzZQoJCQllY2hvICc8cD4nLmdUeHQoJ3Jlc3RyaWN0ZWRfYXJl
YScpLic8L3A+JzsKCX0KCglmdW5jdGlvbiByZW5kZXJfZm9vdGVyICgpIHsKCgkJLy8gQSBz
aW1wbGUgZm9vdGVyCgkJZ2xvYmFsICRwbHVnaW5zX3ZlcjsKCQkkb3V0W10gPSAnPC9kaXY+
JzsKCQkkb3V0W10gPSAnPGRpdiBzdHlsZT0icGFkZGluZy10b3A6IDNlbTsgdGV4dC1hbGln
bjogY2VudGVyOyBjbGVhcjogYm90aDsiPic7CgkJJG91dFtdID0gJHRoaXMtPnBsdWdpbl9u
YW1lOwoJCWlmIChAJHBsdWdpbnNfdmVyWyR0aGlzLT5wbHVnaW5fbmFtZV0pCgkJIAkkb3V0
W10gPSAnICYjMTgzOyAnIC4gJHBsdWdpbnNfdmVyWyR0aGlzLT5wbHVnaW5fbmFtZV07CgkJ
JG91dFtdID0gJzwvZGl2Pic7CgoJCWVjaG8gam9pbignJywgJG91dCk7Cgl9CgoJZnVuY3Rp
b24gZW5kICgpIHsKCQkvLyBPdmVycmlkZSB0aGlzIGZ1bmN0aW9uCgl9CgoJZnVuY3Rpb24g
Zm9ybV9pbnB1dHMgKCkgewoKCQkkb3V0W10gPSBlSW5wdXQoJHRoaXMtPmV2ZW50KTsKCgkJ
aWYgKCR0aGlzLT51c2VfdGFicykgewoKCQkJJHRhYiA9ICR0aGlzLT50YWJzWyR0aGlzLT5h
Y3RpdmVfdGFiXTsKCQkJJG91dFtdID0gaElucHV0KGdicF90YWIsICR0YWItPmV2ZW50KTsK
CQl9CgoJCXJldHVybiBqb2luKCcnLCAkb3V0KTsKCX0KCglmdW5jdGlvbiB1cmwgKCR2YXJz
ID0gYXJyYXkoKSwgJGdwID0gZmFsc2UpIHsKCQkvKgoJCUV4cGFuZHMgJHZhcnMgaW50byBh
IGdldCBzdHlsZSB1cmwgYW5kIHJlZGlyZWN0cyB0byB0aGF0IGxvY2F0aW9uLiBUaGVzZSBj
YW4gYmUKCQlvdmVycmlkZW4gd2l0aCB0aGUgY3VycmVudCBnZXQsIHBvc3QsIHNlc3Npb24g
dmFyaWFibGVzIGRlZmluZWQgaW4gJHRoaXMtPmdwCgkJYnkgc2V0dGluZyAkZ3AgPSB0cnVl
CgkJTk9URTogSWYgJHZhcnMgaXMgbm90IGFuIGFycmF5IG9yIGlzIGVtcHR5IHRoZW4gd2Ug
YXNzdW1lICRncCA9IHRydWUuCgkJKi8KCgkJaWYgKCFpc19hcnJheSgkdmFycykpCgkJCSR2
YXJzID0gZ3BzYSgkdGhpcy0+Z3ApOwoJCWVsc2UgaWYgKCRncCB8fCAhY291bnQoJHZhcnMp
KQoJCQkkdmFycyA9IGFycmF5X21lcmdlKGdwc2EoJHRoaXMtPmdwKSwgJHZhcnMpOwoKCQlm
b3JlYWNoICgkdmFycyBhcyAka2V5ID0+ICR2YWx1ZSkgewoJCQlpZiAoIWVtcHR5KCR2YWx1
ZSkpCgkJCQkkb3V0W10gPSAka2V5Lic9Jy51cmxlbmNvZGUoJHZhbHVlKTsKCQl9CgoJCSRz
Y3JpcHQgPSBodS5iYXNlbmFtZSh0eHBhdGgpLicvaW5kZXgucGhwJzsKCQlyZXR1cm4gJHNj
cmlwdCAuIChpc3NldCgkb3V0KQoJCQk/ICc/Jy5qb2luKCcmJywgJG91dCkKCQkJOiAnJyk7
Cgl9CgoJZnVuY3Rpb24gcmVkaXJlY3QgKCR1cmwgPSAnJywgJHN0YXR1cyA9IDMwMykgewoJ
CS8qCgkJSWYgJHZhcnMgaXMgYW4gYXJyYXksIHVzZSB1cmwoKSB0byBleHBhbmQgYXMgYW4g
R0VUIHN0eWxlIHVybCBhbmQgcmVkaXJlY3QgdG8KCQl0aGF0IGxvY2F0aW9uIHVzaW5nIHRo
ZSBIVFRQIHN0YXR1cyBjb2RlIGRlZmluaXRpb24gZGVmaW5lZCBieSAkc3RhdHVzLgoJCSov
CgoJCXN0YXRpYyAkc3RhdHVzX2RlZmluaXRpb25zID0gYXJyYXkgKAoJCQkzMDEgPT4gIk1v
dmVkIFBlcm1hbmVudGx5IiwKCQkJMzAyID0+ICJGb3VuZCIsCgkJCTMwMyA9PiAiU2VlIE90
aGVyIiwKCQkJMzA3ID0+ICJUZW1wb3JhcnkgUmVkaXJlY3QiCgkJKTsKCgkJaWYgKCFpbl9h
cnJheSgkc3RhdHVzLCBhcnJheV9rZXlzKCRzdGF0dXNfZGVmaW5pdGlvbnMpKSkKCQkJJHN0
YXR1cyA9IDMwMzsKCgkJaWYgKGlzX2FycmF5KCR1cmwpKQoJCQkkdXJsID0gJHRoaXMtPnVy
bCgkdXJsKTsKCQllbHNlIHsKCQkJJHVybF9kZXRhaWxzID0gcGFyc2VfdXJsKCR1cmwpOwoJ
CQlpZiAoIUAkdXJsX2RldGFpbHNbJ3NjaGVtZSddKQoJCQkJJHVybCA9ICdodHRwOi8vJy4k
dXJsOwoJCX0KCgkJaWYgKGVtcHR5KCRfU0VSVkVSWydGQ0dJX1JPTEUnXSkgYW5kIGVtcHR5
KCRfRU5WWydGQ0dJX1JPTEUnXSkpIHsKCQkJaGVhZGVyKCdIVFRQLzEuMSAnLiRzdGF0dXMu
JyAnLiRzdGF0dXNfZGVmaW5pdGlvbnNbJHN0YXR1c10pOwoJCQloZWFkZXIoJ1N0YXR1czog
Jy4kc3RhdHVzKTsKCQkJaGVhZGVyKCdMb2NhdGlvbjogJy4kdXJsKTsKCQkJaGVhZGVyKCdD
b25uZWN0aW9uOiBjbG9zZScpOwoJCQloZWFkZXIoJ0NvbnRlbnQtTGVuZ3RoOiAwJyk7CgkJ
CWV4aXQoMCk7CgkJCX0gZWxzZSB7CgkJCWdsb2JhbCAkc2l0ZW5hbWU7CgkJCSR1cmwgPSBo
dG1sc3BlY2lhbGNoYXJzKCR1cmwsIEVOVF9DT01QQVQsICdVVEYtOCcpOwoJCQllY2hvIDw8
PEVORAoJCQk8IURPQ1RZUEUgaHRtbCBQVUJMSUMgIi0vL1czQy8vRFREIFhIVE1MIDEuMCBU
cmFuc2l0aW9uYWwvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvVFIveGh0bWwxL0RURC94aHRt
bDEtdHJhbnNpdGlvbmFsLmR0ZCI+CgkJCTxodG1sIHhtbG5zPSJodHRwOi8vd3d3LnczLm9y
Zy8xOTk5L3hodG1sIiB4bWw6bGFuZz0iZW4iIGxhbmc9ImVuIj4KCQkJPGhlYWQ+CgkJCQk8
dGl0bGU+JHNpdGVuYW1lPC90aXRsZT4KCQkJCTxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQt
VHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PXV0Zi04IiAvPgoJCQkJPG1ldGEg
aHR0cC1lcXVpdj0icmVmcmVzaCIgY29udGVudD0iMDt1cmw9JHVybCIgLz4KCQkJPC9oZWFk
PgoJCQk8Ym9keT4KCQkJPGEgaHJlZj0iJHVybCI+eyRzdGF0dXNfZGVmaW5pdGlvbnNbJHN0
YXR1c119PC9hPgoJCQk8L2JvZHk+CgkJCTwvaHRtbD4KRU5EOwoJCX0KCX0KCglmdW5jdGlv
biBwcmVmICgka2V5KSB7CgkJZ2xvYmFsICRwcmVmcywgJHR4cF9jdXJyZW50X3BsdWdpbjsK
CgkJJHBsdWdpbiA9ICgkdGhpcy0+cGx1Z2luX25hbWUpID8gJHRoaXMtPnBsdWdpbl9uYW1l
IDogJHR4cF9jdXJyZW50X3BsdWdpbjsKCQkka2V5ID0gJHBsdWdpbi4nXycuJGtleTsKCgkJ
aWYgKEAkdGhpcy0+cHJlZmVyZW5jZXNbJGtleV0pCgkJCXJldHVybiAkdGhpcy0+cHJlZmVy
ZW5jZXNbJGtleV1bJ3ZhbHVlJ107CgkJaWYgKEAkcHJlZnNbJGtleV0pCgkJCXJldHVybiAk
cHJlZnNbJGtleV07CgkJcmV0dXJuIE5VTEw7Cgl9Cn0KCmNsYXNzIEdCUEFkbWluVGFiVmll
dyB7CgkvLwlJbnRlcm5hbCB2YXJpYWJsZXMKCXZhciAkdGl0bGU7Cgl2YXIgJGV2ZW50OwoJ
dmFyICRpc19hY3RpdmU7Cgl2YXIgJHBhcmVudDsKCXZhciAkcGVybWlzc2lvbnMgPSAnMSwy
LDMsNCw1LDYnOwoKCS8vCUNvbnN0cnVjdG9yCglmdW5jdGlvbiBHQlBBZG1pblRhYlZpZXcg
KCR0aXRsZSwgJGV2ZW50LCAmJHBhcmVudCwgJGlzX2RlZmF1bHQgPSBOVUxMKSB7CgoJCSR0
aGlzLT50aXRsZSA9IChmdW5jdGlvbl9leGlzdHMoJ21iX2NvbnZlcnRfY2FzZScpKQoJCQk/
IG1iX2NvbnZlcnRfY2FzZSgkdGl0bGUsIE1CX0NBU0VfVElUTEUsICJVVEYtOCIpCgkJCTog
dWN3b3JkcygkdGl0bGUpOwoKCQkkdGhpcy0+ZXZlbnQgPSAkZXZlbnQ7CgoJCS8vIE5vdGU6
ICR0aGlzLT5wYXJlbnQgb25seSBnZXRzIHNldCBjb3JyZWN0bHkgZm9yIFBIUCA1CgkJJHRo
aXMtPnBhcmVudCA9JiAkcGFyZW50LT5hZGRfdGFiKCR0aGlzLCAkaXNfZGVmYXVsdCk7CgoJ
CS8vIEFkZCBwcml2cyBmb3IgdGhpcyB0YWIKCQlnbG9iYWwgJHR4cF9wZXJtaXNzaW9uczsK
CQkkcGVybXMgPSBAJHR4cF9wZXJtaXNzaW9uc1skdGhpcy0+cGVybWlzc2lvbnNdOwoJCWFk
ZF9wcml2cygkdGhpcy0+cGFyZW50LT5ldmVudC4nLicuJHRoaXMtPmV2ZW50LCAoJHBlcm1z
ID8gJHBlcm1zIDogJHRoaXMtPnBlcm1pc3Npb25zKSk7Cgl9CgoJZnVuY3Rpb24gcGhwXzRf
Zml4ICgpIHsKCgkJLy8gRml4IHJlZmVyZW5jZXMgaW4gUEhQIDQgc28gc3ViIHRhYnMgY2Fu
IGFjY2VzcyB0aGVpciBwYXJlbnQgdGFiCgkJaWYgKHZlcnNpb25fY29tcGFyZShwaHB2ZXJz
aW9uKCksICc1LjAuMCcsICc8JykpIHsKCQkJZ2xvYmFsICR0eHBfY3VycmVudF9wbHVnaW4s
ICRnYnBfYWRtaW5fbGliX3JlZnM7CgkJCSR0aGlzLT5wYXJlbnQgPSYgJGdicF9hZG1pbl9s
aWJfcmVmc1skdHhwX2N1cnJlbnRfcGx1Z2luXTsKCQl9Cgl9CgoJZnVuY3Rpb24gcHJlbG9h
ZCAoKSB7CgkJLy8gT3ZlcnJpZGUgdGhpcyBmdW5jdGlvbgoJfQoKCWZ1bmN0aW9uIHJlbmRl
cl90YWIgKCkgewoKCQkvLyBHcmFiIHRoZSB1cmwgdG8gdGhpcyB0YWIKCQkkdXJsID0gJHRo
aXMtPnBhcmVudC0+dXJsKGFycmF5KGdicF90YWIgPT4gJHRoaXMtPmV2ZW50KSwgdHJ1ZSk7
CgoJCS8vIFdpbGwgbmVlZCB1cGRhdGluZyBpZiBhbnkgaW1wcm92ZW1lbnRzIGhhcHBlbiB0
byB0aGUgYWRtaW4gaW50ZXJmYWNlCgkJJG91dFtdID0gJzxhIGNsYXNzPSJuYXZsaW5rJyAu
ICgkdGhpcy0+aXNfYWN0aXZlID8gJyBhY3RpdmUnIDogJycpIC4gJyIgaHJlZj0iJyAuJHVy
bC4gJyI+JyAuJHRoaXMtPnRpdGxlLiAnPC9hPicubjsKCgkJcmV0dXJuIGpvaW4oJycsICRv
dXQpOwoJfQoKCWZ1bmN0aW9uIG1haW4gKCkgewoJCS8vIE92ZXJyaWRlIHRoaXMgZnVuY3Rp
b24KCX0KCglmdW5jdGlvbiBwcmVmICgka2V5KSB7CgkJcmV0dXJuIEAkdGhpcy0+cGFyZW50
LT5wcmVmKCRrZXkpOwoJfQoKCWZ1bmN0aW9uIHJlZGlyZWN0ICgkdmFycyA9ICcnKSB7CgkJ
JHRoaXMtPnBhcmVudC0+cmVkaXJlY3QoJHZhcnMpOwoJfQoKCWZ1bmN0aW9uIHNldF9wcmVm
ZXJlbmNlICgka2V5LCAkdmFsdWUsICR0eXBlID0gJycpIHsKCQlyZXR1cm4gJHRoaXMtPnBh
cmVudC0+c2V0X3ByZWZlcmVuY2UoJGtleSwgJHZhbHVlLCAkdHlwZSk7Cgl9CgoJZnVuY3Rp
b24gcmVtb3ZlX3ByZWZlcmVuY2UgKCRrZXkpIHsKCQlyZXR1cm4gJHRoaXMtPnBhcmVudC0+
cmVtb3ZlX3ByZWZlcmVuY2UoJGtleSk7Cgl9CgoJZnVuY3Rpb24gdXJsICgkdmFycywgJGdw
ID0gZmFsc2UpIHsKCQlyZXR1cm4gJHRoaXMtPnBhcmVudC0+dXJsKCR2YXJzLCAkZ3ApOwoJ
fQoKCWZ1bmN0aW9uIGZvcm1faW5wdXRzICgpIHsKCQlyZXR1cm4gJHRoaXMtPnBhcmVudC0+
Zm9ybV9pbnB1dHMoKTsKCX0KfQoKY2xhc3MgR0JQUHJlZmVyZW5jZVRhYlZpZXcgZXh0ZW5k
cyBHQlBBZG1pblRhYlZpZXcgewoKCXZhciAkcGVybWlzc2lvbnMgPSAncHJlZnMnOwoKCWZ1
bmN0aW9uIEdCUFByZWZlcmVuY2VUYWJWaWV3ICgmJHBhcmVudCwgJGlzX2RlZmF1bHQgPSBO
VUxMKSB7CgkJLy8gQ2FsbCB0aGUgcGFyZW50IGNvbnN0cnVjdG9yCgkJR0JQQWRtaW5UYWJW
aWV3OjpHQlBBZG1pblRhYlZpZXcoZ1R4dCgndGFiX3ByZWZlcmVuY2VzJyksICdwcmVmZXJl
bmNlJywgJHBhcmVudCwgJGlzX2RlZmF1bHQpOwoJfQoKCWZ1bmN0aW9uIHByZWxvYWQgKCkg
ewoJCWlmIChwcygnc3RlcCcpID09ICdwcmVmc19zYXZlJykgewoJCQlmb3JlYWNoICgkdGhp
cy0+cGFyZW50LT5wcmVmZXJlbmNlcyBhcyAka2V5ID0+ICRwcmVmKSB7CgkJCQlleHRyYWN0
KCRwcmVmKTsKCQkJCSR2YWx1ZSA9IHBzKCRrZXkpOwoJCQkJaWYgKGlzX2NhbGxhYmxlKGFy
cmF5KCYkdGhpcy0+cGFyZW50LCAkdHlwZSkpKQoJCQkJCSR2YWx1ZSA9IGNhbGxfdXNlcl9m
dW5jKGFycmF5KCYkdGhpcy0+cGFyZW50LCAkdHlwZSksICd1aV9vdXQnLCAkdmFsdWUpOwoJ
CQkJJHRoaXMtPnBhcmVudC0+c2V0X3ByZWZlcmVuY2UoJGtleSwgJHZhbHVlKTsKCQkJfQoJ
CX0KCX0KCglmdW5jdGlvbiBtYWluICgpIHsKCQkvLyBNYWtlIHR4cF9wcmVmcy5waHAgaGFw
cHkgOikKCQlnbG9iYWwgJGV2ZW50OwoJCSRldmVudCA9ICR0aGlzLT5wYXJlbnQtPmV2ZW50
OwoKCQlpbmNsdWRlX29uY2UgdHhwYXRoLicvaW5jbHVkZS90eHBfcHJlZnMucGhwJzsKCgkJ
ZWNobwoJCQknPGZvcm0gYWN0aW9uPSJpbmRleC5waHAiIG1ldGhvZD0icG9zdCI+JywKCQkJ
c3RhcnRUYWJsZSgnbGlzdCcpOwoKCQlmb3JlYWNoICgkdGhpcy0+cGFyZW50LT5wcmVmZXJl
bmNlcyBhcyAka2V5ID0+ICRwcmVmKSB7CgkJCWV4dHJhY3QoJHByZWYpOwoKCQkJJG91dCA9
IHRkYShnVHh0KCRrZXkpLCAnIHN0eWxlPSJ0ZXh0LWFsaWduOnJpZ2h0O3ZlcnRpY2FsLWFs
aWduOm1pZGRsZSInKTsKCgkJCXN3aXRjaCAoJHR5cGUpIHsKCQkJCWNhc2UgJ3RleHRfaW5w
dXQnOgoJCQkJCSRvdXQgLj0gdGQocHJlZl9mdW5jKCd0ZXh0X2lucHV0JywgJGtleSwgJHZh
bHVlLCAyMCkpOwoJCQkJYnJlYWs7CgkJCQlkZWZhdWx0OgoJCQkJCWlmIChpc19jYWxsYWJs
ZShhcnJheSgmJHRoaXMtPnBhcmVudCwgJHR5cGUpKSkKCQkJCQkJJG91dCAuPSB0ZChjYWxs
X3VzZXJfZnVuYyhhcnJheSgmJHRoaXMtPnBhcmVudCwgJHR5cGUpLCAndWlfaW4nLCAkdmFs
dWUsICRrZXkpKTsKCQkJCQllbHNlCgkJCQkJCSRvdXQgLj0gdGQocHJlZl9mdW5jKCR0eXBl
LCAka2V5LCAkdmFsdWUsIDUwKSk7CgkJCQlicmVhazsKCQkJfQoKCQkJJG91dCAuPSB0ZGEo
JHRoaXMtPnBvcEhlbHAoJGtleSksICcgc3R5bGU9InZlcnRpY2FsLWFsaWduOm1pZGRsZSIn
KTsKCQkJZWNobyB0cigkb3V0KTsKCQl9CgoJCWVjaG8KCQkJdHIodGRhKGZJbnB1dCgnc3Vi
bWl0JywgJ1N1Ym1pdCcsIGdUeHQoJ3NhdmVfYnV0dG9uJyksICdwdWJsaXNoJyksICcgY29s
c3Bhbj0iMyIgY2xhc3M9Im5vbGluZSInKSksCgkJCWVuZFRhYmxlKCksCgkJCSR0aGlzLT5w
YXJlbnQtPmZvcm1faW5wdXRzKCksCgkJCXNJbnB1dCgncHJlZnNfc2F2ZScpLAoJCQknPC9m
b3JtPic7Cgl9CgoJZnVuY3Rpb24gcG9wSGVscCAoJGhlbHB2YXIpIHsKCQkkc2NyaXB0ID0g
aHUuYmFzZW5hbWUodHhwYXRoKS4nL2luZGV4LnBocCc7CgkJcmV0dXJuICc8YSBocmVmPSIn
LiRzY3JpcHQuJz9ldmVudD1wbHVnaW4nLmEuJ3N0ZXA9cGx1Z2luX2hlbHAnLmEuJ25hbWU9
Jy4kdGhpcy0+cGFyZW50LT5wbHVnaW5fbmFtZS4nIycuJGhlbHB2YXIuJyIgY2xhc3M9InBv
cGhlbHAiPj88L2E+JzsKCX0KfQoKY2xhc3MgR0JQV2l6YXJkVGFiVmlldyBleHRlbmRzIEdC
UEFkbWluVGFiVmlldyB7CgoJdmFyICRpbnN0YWxsYXRpb25fc3RlcHMgPSBhcnJheSgpOwoJ
dmFyICR3aXpfcmVwb3J0ID0gYXJyYXkoKTsKCXZhciAkcGVybWlzc2lvbnMgPSAnYWRtaW4u
ZWRpdCc7CgoJZnVuY3Rpb24gR0JQV2l6YXJkVGFiVmlldyAoJiRwYXJlbnQsICRpc19kZWZh
dWx0ID0gTlVMTCwgJHRpdGxlID0gJ1dpemFyZHMnKSB7CgkJZ2xvYmFsICR0ZXh0YXJyYXk7
CgoJCSMKCQkjCUdldCB0aGUgc3RyaW5ncyBhbmQgbWVyZ2UgaW50byB0aGUgdGV4dGFycmF5
IGJlZm9yZSB3ZSBnZXQgdGhlIHN0ZXBzLi4uCgkJIwoJCSRzdHJpbmdzID0gJHRoaXMtPmdl
dF9zdHJpbmdzKCk7CgkJJHRleHRhcnJheSA9IGFycmF5X21lcmdlKCRzdHJpbmdzICwgJHRl
eHRhcnJheSk7CgoJCSMKCQkjCU5vdyBnZXQgdGhlIHN0ZXBzLi4uCgkJIwoJCSR0aGlzLT5p
bnN0YWxsYXRpb25fc3RlcHMgPSAkdGhpcy0+Z2V0X3N0ZXBzKCk7CgoJCS8vIENhbGwgdGhl
IHBhcmVudCBjb25zdHJ1Y3RvcgoJCUdCUEFkbWluVGFiVmlldzo6R0JQQWRtaW5UYWJWaWV3
KCR0aXRsZSwgJ3dpemFyZCcsICRwYXJlbnQsICRpc19kZWZhdWx0KTsKCX0KCglmdW5jdGlv
biBnZXRfc3RlcHMgKCkgewoJCSMKCQkjCU92ZXJyaWRlIHRoaXMgbWV0aG9kIGluIGRlcml2
ZWQgY2xhc3NlcyB0byByZXR1cm4gdGhlIGFwcHJvcHJpYXRlIHNldHVwL2NsZWFudXAgc3Rl
cHMuCgkJIwoJCSRzdGVwcyA9IGFycmF5KAoJCQknYmFzaWMnIAkJPT4gYXJyYXkoJ3NldHVw
JyA9PiAnQmFzaWMgc2V0dXAgc3RlcCcsICdjbGVhbnVwJyA9PiAnQmFzaWMgY2xlYW51cCBz
dGVwJyksCgkJCSdvcHRpb25hbCcJCT0+IGFycmF5KCdzZXR1cCcgPT4gJ09wdGlvbmFsIHNl
dHVwIHN0ZXAnLCAnY2xlYW51cCcgPT4gJ09wdGlvbmFsIGNsZWFudXAgc3RlcCcsICdvcHRp
b25hbCcgPT4gdHJ1ZSAsICdjaGVja2VkJyA9PiAwKSwKCQkJJ2hhc19vcHRpb25zJwk9PiBh
cnJheSgnc2V0dXAnID0+ICdTZXR1cCBzdGVwIHdpdGggYSBvcHRpb24nLCAnY2xlYW51cCcg
PT4gJ0NsZWFudXAgc3RlcCB3aXRoIGEgb3B0aW9uJywgJ2hhc19vcHRpb25zJyA9PiB0cnVl
KSwKCQkpOwoJCXJldHVybiAkc3RlcHM7Cgl9CgoJZnVuY3Rpb24gZ2V0X3N0cmluZ3MgKCRs
YW5ndWFnZSA9ICcnKSB7CgkJIwoJCSMJT3ZlcnJpZGUgdGhpcyBmdW5jdGlvbiBpbiBkZXJp
dmVkIGNsYXNzZXMgdG8gZGVmaW5lL2NoYW5nZSB0aGUgc2V0IG9mIHN0cmluZ3MgdG8KCQkj
IGluamVjdCBpbnRvICR0ZXh0YXJyYXkgdG8gbG9jYWxpc2UgdGhlIHdpemFyZC4KCQkjCgkJ
JHN0cmluZ3MgPSBhcnJheSgKCQkJJ2dicF9hZGxpYl93aXotdmVyc2lvbl9lcnJvcnMnCQk9
PiAnVmVyc2lvbiBFcnJvcnMnLAoJCQknZ2JwX2FkbGliX3dpei12ZXJzaW9uX3JlYXNvbicJ
CT0+ICdUaGlzIHBsdWdpbiBjYW5ub3Qgb3BlcmF0ZSBpbiB0aGlzIGluc3RhbGxhdGlvbiBi
ZWNhdXNlJiM4MjMwOycsCgkJCSdnYnBfYWRsaWJfd2l6LXZlcnNpb25faXRlbScJCT0+ICdJ
dCByZXF1aXJlcyA8c3Ryb25nIGNsYXNzPSJmYWlsdXJlIj57bmFtZX0ge21pbn08L3N0cm9u
Zz4gb3IgYWJvdmUsIGN1cnJlbnQgaW5zdGFsbCBpcyB7Y3VycmVudH0uJywKCQkJJ2dicF9h
ZGxpYl93aXotc2V0dXAnIAkJCQk9PiAnU2V0dXAnLAoJCQknZ2JwX2FkbGliX3dpei1zZXR1
cF9zdGVwcycgCQk9PiAnVGhlIGZvbGxvd2luZyBzZXR1cCBzdGVwcyB3aWxsIGJlIHRha2Vu
JiM4MjMwOycsCgkJCSdnYnBfYWRsaWJfd2l6LXNldHVwX3JlcG9ydCcJCT0+ICdTZXR1cCBS
ZXBvcnQmIzgyMzA7JywKCQkJJ2dicF9hZGxpYl93aXotY2xlYW51cCcgCQkJPT4gJ0NsZWFu
dXAnLAoJCQknZ2JwX2FkbGliX3dpei1jbGVhbnVwX3N0ZXBzJyAJCT0+ICdUaGUgZm9sbG93
aW5nIGNsZWFudXAgc3RlcHMgd2lsbCBiZSB0YWtlbiYjODIzMDsnLAoJCQknZ2JwX2FkbGli
X3dpei1jbGVhbnVwX3JlcG9ydCcJCT0+ICdDbGVhbnVwIFJlcG9ydCYjODIzMDsnLAoJCQkn
Z2JwX2FkbGliX3dpei1jbGVhbnVwX25leHQnIAkJPT4gJ1RoZSBwbHVnaW4gY2FuIG5vdyBi
ZSBkaXNhYmxlZCBhbmQvb3IgdW5pbnN0YWxsZWQuJywKCQkJJ2dicF9hZGxpYl93aXotZG9u
ZScgCQkJCT0+ICdEb25lJywKCQkJJ2dicF9hZGxpYl93aXotc2tpcHBlZCcJCQkJPT4gJ1Nr
aXBwZWQnLAoJCQknZ2JwX2FkbGliX3dpei1mYWlsZWQnCQkJCT0+ICdGYWlsdXJlJywKCQkJ
J2dicF9hZGxpYl93aXotc3RlcF9iYXNpYycJCQk9PiAnQmFzaWMgU3RlcCcsCgkJCSdnYnBf
YWRsaWJfd2l6LXN0ZXBfb3B0aW9uYWwnCQk9PiAnT3B0aW9uYWwgc3RlcCcsCgkJCSdnYnBf
YWRsaWJfd2l6LXN0ZXBfY29tcGxleCcJCT0+ICdTdGVwIHdpdGggb3B0aW9uKHMpJywKCQkJ
J2dicF9hZGxpYl93aXotc3RlcF9jb21wbGV4X3R4dCcJPT4gJ1RoaXMge3N0ZXB9IHN0ZXAg
aGFzIGFuIG9wdGlvbi9vcHRpb25zLicsCgkJKTsKCQlyZXR1cm4gJHN0cmluZ3M7Cgl9CgoJ
ZnVuY3Rpb24gdmVyc2lvbnNfb2sgKCkgewoJCSRtc2cgPSAnJzsKCgkJIwoJCSMJQ2hlY2sg
dGhlIHBsdWdpbiBjYW4gcnVuIGluIHRoaXMgZW52aXJvbm1lbnQuCgkJIwoJCSMJUmV0dXJu
OiBUUlVFIC0+IFllcy4KCQkjCUhUTUwgZm9ybWF0dGVkIHN0cmluZyAtPiBObywgYW5kIGV4
cGxhaW4gd2h5LgoJCSMKCQkkdGVzdHMgPSAkdGhpcy0+Z2V0X3JlcXVpcmVkX3ZlcnNpb25z
KCk7CgkJaWYgKGNvdW50KCR0ZXN0cykpCgkJCWZvcmVhY2ggKCR0ZXN0cyBhcyAkbmFtZSA9
PiAkdmVyc2lvbnMpIHsKCQkJCWlmKCBhcnJheV9rZXlfZXhpc3RzKCAnY3VzdG9tX2hhbmRs
ZXInICwgJHZlcnNpb25zICkgJiYgaXNfY2FsbGFibGUoICR2ZXJzaW9uc1snY3VzdG9tX2hh
bmRsZXInXSApICkgewoJCQkJCSMKCQkJCQkjIEFsbG93IGRlcml2ZWQgY2xhc3NlcyB0byBk
ZWZpbmUgdGhlaXIgb3duIGNoZWNraW5nIHJvdXRpbmVzLi4uCgkJCQkJIwoJCQkJCSRmbiA9
ICR2ZXJzaW9uc1snY3VzdG9tX2hhbmRsZXInXTsKCQkJCQkkcmVzID0gY2FsbF91c2VyX2Z1
bmMoICRmbiAsICRuYW1lICwgJHZlcnNpb25zICk7CgkJCQkJaWYoICRyZXMgKQoJCQkJCQkk
bXNnW10gPSB0YWcoJHJlcyAsICdsaScsICcgc3R5bGU9InRleHQtYWxpZ246IGxlZnQ7IHBh
ZGRpbmctdG9wOiAwLjc1ZW07IicpOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJaWYgKHZlcnNp
b25fY29tcGFyZSgkdmVyc2lvbnNbJ2N1cnJlbnQnXSwgJHZlcnNpb25zWydtaW4nXSAsICc8
JykpIHsKCQkJCQkJJHJlcyA9IGdUeHQoJ2dicF9hZGxpYl93aXotdmVyc2lvbl9pdGVtJyAs
IGFycmF5KCd7bmFtZX0nID0+ICRuYW1lICwgJ3ttaW59JyA9PiAkdmVyc2lvbnNbJ21pbidd
ICwgJ3tjdXJyZW50fScgPT4gJHZlcnNpb25zWydjdXJyZW50J10pKTsKCQkJCQkJJG1zZ1td
ID0gdGFnKCRyZXMgLCAnbGknLCAnIHN0eWxlPSJ0ZXh0LWFsaWduOiBsZWZ0OyBwYWRkaW5n
LXRvcDogMC43NWVtOyInKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJaWYgKCFlbXB0eSgkbXNn
KSkKCQkJcmV0dXJuIHRhZyhqb2luKCcnICwgJG1zZykgLCAnb2wnKTsKCgkJcmV0dXJuIHRy
dWU7Cgl9CgoJZnVuY3Rpb24gZ2V0X3JlcXVpcmVkX3ZlcnNpb25zICgpIHsKCQlnbG9iYWwg
JHByZWZzOwoKCQkjCgkJIwlPdmVycmlkZSB0aGlzIGZ1bmN0aW9uIHRvIHJldHVybiBhbiBh
cnJheSBvZiB0ZXN0cyB0byBiZSBjYXJyaWVkIG91dC4KCQkjCgkJJHRlc3RzID0gYXJyYXko
J1R4UCcgPT4gYXJyYXkoCgkJCSdjdXJyZW50Jwk9PiAkcHJlZnNbJ3ZlcnNpb24nXSwKCQkJ
J21pbicJCT0+ICc0LjAuMycsCgkJKSk7CgkJcmV0dXJuICR0ZXN0czsKCX0KCglmdW5jdGlv
biBtYWluICgpIHsKCQkkb3V0W10gPSAnPHN0eWxlIHR5cGU9InRleHQvY3NzIj4gLnN1Y2Nl
c3MgeyBjb2xvcjogIzAwOTkwMDsgfSAuZmFpbHVyZSB7IGNvbG9yOiAjRkYwMDAwOyB9IC5z
a2lwcGVkIHsgY29sb3I6ICMwMDAwRkY7IH0gPC9zdHlsZT4nOwoJCSRvdXRbXSA9ICc8ZGl2
IHN0eWxlPSJib3JkZXI6IDFweCBzb2xpZCBncmF5OyB3aWR0aDogNTBlbTsgdGV4dC1hbGln
bjogY2VudGVyOyBtYXJnaW46IDFlbSBhdXRvOyBwYWRkaW5nOiAxZW07IGNsZWFyOiBib3Ro
OyI+JzsKCgkJJGZpZWxkc2V0X3N0eWxlID0gJyBzdHlsZT0idGV4dC1hbGlnbjogbGVmdDsg
cGFkZGluZzogMWVtIDAiJzsKCgkJJHN0ZXAgPSBncHMoJ3N0ZXAnKTsKCQlpZiAoZW1wdHko
JHN0ZXApKSB7CgkJCSRyZXN1bHQgPSAkdGhpcy0+dmVyc2lvbnNfb2soKTsKCQkJaWYgKGlz
X3N0cmluZygkcmVzdWx0KSkKCQkJCSRzdGVwID0gJ3ZlcnNpb25fZXJyb3InOwoJCQllbHNl
CgkJCQkkc3RlcCA9ICgkdGhpcy0+aW5zdGFsbGVkKCkpID8gJ2NsZWFudXAtdmVyaWZ5JyA6
ICdzZXR1cC12ZXJpZnknOwoKCQkJJF9QT1NUWydzdGVwJ10gPSAkc3RlcDsKCQl9CgoJCXN3
aXRjaCAoJHN0ZXApIHsKCQkJY2FzZSAndmVyc2lvbl9lcnJvcic6CgkJCQkkb3V0W10gPSBo
ZWQoZ1R4dCgnZ2JwX2FkbGliX3dpei12ZXJzaW9uX2Vycm9ycycpICwgMSk7CgkJCQkkb3V0
W10gPSBncmFmKGdUeHQoJ2dicF9hZGxpYl93aXotdmVyc2lvbl9yZWFzb24nKSk7CgkJCQkk
b3V0W10gPSAkcmVzdWx0OwoJCQlicmVhazsKCgkJCWNhc2UgJ3NldHVwLXZlcmlmeSc6CgkJ
CS8vIFJlbmRlciB0aGUgc2V0dXAgd2l6YXJkIGluaXRpYWwgc3RlcC4uLgoJCQkJJG91dFtd
ID0gaGVkKGdUeHQoJ2dicF9hZGxpYl93aXotc2V0dXAnKSAsIDEpOwoJCQkJJG91dFtdID0g
Z3JhZihnVHh0KCdnYnBfYWRsaWJfd2l6LXNldHVwX3N0ZXBzJykpOwoJCQkJJG91dFtdID0g
dGFnKHRhZygkdGhpcy0+d2l6YXJkX3N0ZXBzKCdzZXR1cCcpICwgJ29sJykgLCAnZmllbGRz
ZXQnLCAkZmllbGRzZXRfc3R5bGUpOwoJCQkJJG91dFtdID0gZklucHV0KCdzdWJtaXQnLCAn
JywgZ1R4dCgnZ2JwX2FkbGliX3dpei1zZXR1cCcpLCAnJyk7CgkJCQkkb3V0W10gPSAkdGhp
cy0+Zm9ybV9pbnB1dHMoKTsKCQkJCSRvdXRbXSA9IHNJbnB1dCgnc2V0dXAnKTsKCQkJYnJl
YWs7CgoJCQljYXNlICdzZXR1cCc6CgkJCS8vIFJlbmRlciB0aGUgcG9zdC1zZXR1cCBzY3Jl
ZW4uLi4KCQkJCSRvdXRbXSA9IGhlZChnVHh0KCdnYnBfYWRsaWJfd2l6LXNldHVwX3JlcG9y
dCcpICwgMSk7CgkJCQkkb3V0W10gPSB0YWcoJHRoaXMtPndpemFyZF9yZXBvcnQoKSAsICdm
aWVsZHNldCcsICRmaWVsZHNldF9zdHlsZSk7CgkJCQkkb3V0W10gPSBmSW5wdXQoJ3N1Ym1p
dCcsICcnICwgZ1R4dCgnbmV4dCcpICwgJycpOwoJCQkJJG91dFtdID0gZUlucHV0KCR0aGlz
LT5wYXJlbnQtPmV2ZW50KTsKCQkJCSRvdXRbXSA9IGhJbnB1dChnYnBfdGFiLCAncHJlZmVy
ZW5jZScpOwoJCQlicmVhazsKCgkJCWNhc2UgJ2NsZWFudXAtdmVyaWZ5JzoKCQkJLy8gUmVu
ZGVyIHRoZSBjbGVhbnVwIHdpemFyZCBpbml0aWFsIHN0ZXAuLi4KCQkJCSRvdXRbXSA9IGhl
ZChnVHh0KCdnYnBfYWRsaWJfd2l6LWNsZWFudXAnKSAsIDEpOwoJCQkJJG91dFtdID0gZ3Jh
ZihnVHh0KCdnYnBfYWRsaWJfd2l6LWNsZWFudXBfc3RlcHMnKSk7CgkJCQkkb3V0W10gPSB0
YWcodGFnKCR0aGlzLT53aXphcmRfc3RlcHMoJ2NsZWFudXAnKSAsICdvbCcpICwgJ2ZpZWxk
c2V0JywgJGZpZWxkc2V0X3N0eWxlKTsKCQkJCSRvdXRbXSA9IGZJbnB1dCgnc3VibWl0Jywg
JycsIGdUeHQoJ2dicF9hZGxpYl93aXotY2xlYW51cCcpLCAnJyk7CgkJCQkkb3V0W10gPSAk
dGhpcy0+Zm9ybV9pbnB1dHMoKTsKCQkJCSRvdXRbXSA9IHNJbnB1dCgnY2xlYW51cCcpOwoJ
CQlicmVhazsKCgkJCWNhc2UgJ2NsZWFudXAnOgoJCQkvLyBSZW5kZXIgdGhlIHBvc3QtY2xl
YW51cCBzY3JlZW4uLi4KCQkJCSRvdXRbXSA9IGhlZChnVHh0KCdnYnBfYWRsaWJfd2l6LWNs
ZWFudXBfcmVwb3J0JykgLCAxKTsKCQkJCSRvdXRbXSA9IHRhZygkdGhpcy0+d2l6YXJkX3Jl
cG9ydCgpICwgJ2ZpZWxkc2V0JywgJGZpZWxkc2V0X3N0eWxlKTsKCQkJCSRvdXRbXSA9IGdy
YWYoZ1R4dCgnZ2JwX2FkbGliX3dpei1jbGVhbnVwX25leHQnKSk7CgkJCQkkb3V0W10gPSBm
SW5wdXQoJ3N1Ym1pdCcsICcnICwgZ1R4dCgnbmV4dCcpICwgJycpOwoJCQkJJG91dFtdID0g
ZUlucHV0KCdwbHVnaW4nKTsKCQkJYnJlYWs7CgkJfQoKCQkkb3V0W10gPSAnPC9kaXY+JzsK
CgkJJHZlcmlmeSA9IChpbl9hcnJheSgkc3RlcCwgYXJyYXkoJ3NldHVwLXZlcmlmeScsICdj
bGVhbnVwLXZlcmlmeScpKSkKCQkJPyAidmVyaWZ5KCciLmRvU2xhc2goZ1R4dCgnYXJlX3lv
dV9zdXJlJykpLiInKSIKCQkJOiAnJzsKCgkJZWNobyBmb3JtKGpvaW4obiwgJG91dCksICcn
LCAkdmVyaWZ5KTsKCX0KCglmdW5jdGlvbiBpbnN0YWxsZWQgKCkgewoJCXJldHVybiBmYWxz
ZTsKCX0KCglmdW5jdGlvbiB3aXphcmRfc3RlcHMgKCRzdGVwKSB7CgkJJHN0ZXBfZGV0YWls
cyA9ICcnOwoKCQlmb3JlYWNoICgkdGhpcy0+aW5zdGFsbGF0aW9uX3N0ZXBzIGFzICRrZXkg
PT4gJGRldGFpbCkgewoJCQlpZiAoQCRkZXRhaWxbJHN0ZXBdKSB7CgkJCQkkb3B0aW9ucyA9
ICcnOwoJCQkJaWYgKEAkZGV0YWlsWydoYXNfb3B0aW9ucyddKSB7CgkJCQkJJGZ1bmN0aW9u
ID0gYXJyYXkoJiR0aGlzLCAnb3B0aW9uXycuJGtleSk7CgkJCQkJaWYgKGlzX2NhbGxhYmxl
KCRmdW5jdGlvbikpCgkJCQkJCSRvcHRpb25zID0gbi50YWcoY2FsbF91c2VyX2Z1bmMoJGZ1
bmN0aW9uLCAkc3RlcCksICdzcGFuJywgJyBpZD0id2l6YXJkXycuJGtleS4nIiBzdHlsZT0i
ZGlzcGxheTogYmxvY2s7IG1hcmdpbi1yaWdodDogMWVtOyBwYWRkaW5nOiAwLjVlbTsgYmFj
a2dyb3VuZC1jb2xvcjogI2VlZTsiJyk7CgkJCQl9CgoJCQkJJGNoZWNrYm94ID0gJyc7CgkJ
CQlpZiAoQCRkZXRhaWxbJ29wdGlvbmFsJ10pIHsKCQkJCQkkY2hlY2tlZCA9IChpc3NldCgk
ZGV0YWlsWydjaGVja2VkJ10pKSA/ICRkZXRhaWxbJ2NoZWNrZWQnXSA6IDAgOwoJCQkJCSRj
aGVja2JveCA9IGNoZWNrYm94Mignb3B0aW9uYWxfJy4ka2V5LCAkY2hlY2tlZCwgKCRvcHRp
b25zID8gJyIgb25jbGljaz0idG9nZ2xlRGlzcGxheShcJ3dpemFyZF8nLiRrZXkuJ1wnKTsn
IDogJycpKTsKCQkJCX0KCgkJCQkkc3RlcF9kZXRhaWxzIC49IG4udGFnKGdyYWYoCgkJCQkJ
dGFnKCRkZXRhaWxbJHN0ZXBdLiRjaGVja2JveCwgJ2xhYmVsJykuJG9wdGlvbnMKCQkJCSks
ICdsaScpOwoJCQl9CgkJfQoKCQlyZXR1cm4gJHN0ZXBfZGV0YWlscy5uOwoJfQoKCWZ1bmN0
aW9uIHdpemFyZF9yZXBvcnQgKCkgewoJCS8vIFJlbmRlciB0aGUgd2l6YXJkIHJlcG9ydCBh
cyBhbiBvcmRlcmVkIGxpc3QuIFRoZXJlIG1heWJlCgkJLy8gJ3N1YicgcmVwb3J0cyB3aGlj
aCB3ZSBuZWVkIHRvIGFsc28gcmVuZGVyIGFzIG9yZGVyZWQgbGlzdHMKCQkkb3V0ID0gYXJy
YXkoKTsKCQlmb3JlYWNoICgkdGhpcy0+d2l6X3JlcG9ydCBhcyAkcmVwb3J0KSB7CgkJCSRv
dXRfc3ViID0gYXJyYXkoKTsKCgkJCS8vIFNraXAgdGhlIGZpcnN0IGVsZW1lbnQgYXMgaXQg
aXMgaW4gZmFjdCB0aGUgcGFyZW50IHJlcG9ydAoJCQluZXh0KCRyZXBvcnQpOwoKCQkJLy8g
TGV0cyBnZW5lcmF0ZSBhIHN1YiByZXBvcnQgLSBpZiB0aGVyZSBhcmUgbW9yZSBlbGVtZW50
cwoJCQl3aGlsZSAobGlzdCgka2V5LCAkcmVwb3J0X3N1YikgPSBlYWNoKCRyZXBvcnQpKQoJ
CQkJJG91dF9zdWJbXSA9IHRhZygkcmVwb3J0X3N1YiAsICdsaScpOwoKCQkJLy8gQ2hlY2sg
dG8gc2VlIGlmIHdlIGFjdHVhbGx5IGhhdmUgYSBzdWIgcmVwb3J0IC0gdGFnIGl0IGFzIG5l
Y2Vzc2FyeQoJCQkkb3V0X3N1YiA9IChjb3VudCgkb3V0X3N1YikgPiAwKQoJCQkJPyB0YWco
am9pbihuICwgJG91dF9zdWIpLCAnb2wnKQoJCQkJOiAnJzsKCgkJCSRvdXRbXSA9IHRhZygk
cmVwb3J0WzBdIC4gJG91dF9zdWIgLCAnbGknKTsKCQl9CgkJcmV0dXJuIHRhZyhqb2luKG4g
LCAkb3V0KSAsICdvbCcpOwoJfQoKCWZ1bmN0aW9uIGFkZF9yZXBvcnRfaXRlbSAoJHN0cmlu
ZyAsICRvayA9IE5VTEwsICRzdWIgPSBmYWxzZSkgewoJCWlmIChpc3NldCgkb2spKSB7CgkJ
CXN3aXRjaCAoJG9rKSB7CgkJCQljYXNlICcxJyA6CgkJCQkJJGNsYXNzID0gJ3N1Y2Nlc3Mn
OwoJCQkJCSRva2ZhaWwgPSBnVHh0KCdnYnBfYWRsaWJfd2l6LWRvbmUnKTsKCQkJCWJyZWFr
OwoKCQkJCWRlZmF1bHQgOgoJCQkJY2FzZSAnMCcgOgoJCQkJCSRjbGFzcyA9ICdmYWlsdXJl
JzsKCQkJCQkkb2tmYWlsID0gZ1R4dCgnZ2JwX2FkbGliX3dpei1mYWlsZWQnKTsKCQkJCWJy
ZWFrOwoKCQkJCWNhc2UgJ3NraXBwZWQnIDoKCQkJCQkkY2xhc3MgPSAnc2tpcHBlZCc7CgkJ
CQkJJG9rZmFpbCA9IGdUeHQoJ2dicF9hZGxpYl93aXotc2tpcHBlZCcpOwoJCQkJYnJlYWs7
CgkJCX0KCQkJJG9rZmFpbCA9ICcgOiA8c3BhbiBjbGFzcz0iJy4kY2xhc3MuJyI+Jy50YWco
JG9rZmFpbCwgJ3N0cm9uZycpLic8L3NwYW4+JzsKCQl9CgoJCSRsaW5lID0gZ3JhZigkc3Ry
aW5nIC4gKGlzc2V0KCRva2ZhaWwpID8gJG9rZmFpbCA6ICcnKSk7CgoJCWlmICgkc3ViICYm
IGNvdW50KCR0aGlzLT53aXpfcmVwb3J0KSA+IDApCgkJCSR0aGlzLT53aXpfcmVwb3J0W2Nv
dW50KCR0aGlzLT53aXpfcmVwb3J0KSAtIDFdW10gPSAkbGluZTsKCQllbHNlCgkJCSR0aGlz
LT53aXpfcmVwb3J0W10gPSBhcnJheSgkbGluZSk7Cgl9CgoJZnVuY3Rpb24gc2V0dXBfYmFz
aWMgKCkgewoJCSR0aGlzLT5hZGRfcmVwb3J0X2l0ZW0oZ1R4dCgnZ2JwX2FkbGliX3dpei1z
dGVwX2Jhc2ljJyksIHRydWUpOwoJfQoKCWZ1bmN0aW9uIGNsZWFudXBfYmFzaWMgKCkgewoJ
CSR0aGlzLT5hZGRfcmVwb3J0X2l0ZW0oZ1R4dCgnZ2JwX2FkbGliX3dpei1zdGVwX2Jhc2lj
JyksIGZhbHNlKTsKCX0KCglmdW5jdGlvbiBzZXR1cF9vcHRpb25hbCAoKSB7CgkJJHRoaXMt
PmFkZF9yZXBvcnRfaXRlbShnVHh0KCdnYnBfYWRsaWJfd2l6LXN0ZXBfb3B0aW9uYWwnKSwg
dHJ1ZSk7Cgl9CgoJZnVuY3Rpb24gY2xlYW51cF9vcHRpb25hbCAoKSB7CgkJJHRoaXMtPmFk
ZF9yZXBvcnRfaXRlbShnVHh0KCdnYnBfYWRsaWJfd2l6LXN0ZXBfb3B0aW9uYWwnKSwgZmFs
c2UpOwoJfQoKCWZ1bmN0aW9uIHNldHVwX2hhc19vcHRpb25zICgpIHsKCQkkdGhpcy0+YWRk
X3JlcG9ydF9pdGVtKGdUeHQoJ2dicF9hZGxpYl93aXotc3RlcF9jb21wbGV4JyksIHRydWUp
OwoJfQoKCWZ1bmN0aW9uIGNsZWFudXBfaGFzX29wdGlvbnMgKCkgewoJCSR0aGlzLT5hZGRf
cmVwb3J0X2l0ZW0oZ1R4dCgnZ2JwX2FkbGliX3dpei1zdGVwX2NvbXBsZXgnKSwgZmFsc2Up
OwoJfQoKCWZ1bmN0aW9uIG9wdGlvbl9oYXNfb3B0aW9ucyAoJHN0ZXApIHsKCQlyZXR1cm4g
Z3JhZihnVHh0KCdnYnBfYWRsaWJfd2l6LXN0ZXBfY29tcGxleF90eHQnICwgYXJyYXkoJ3tz
dGVwfScgPT4gJHN0ZXApKSkueWVzbm9SYWRpbygnd2l6YXJkX2hhc19vcHRpb25zX3Rlc3Qn
LCAxKTsKCX0KfQoiO3M6NDoidHlwZSI7czoxOiIyIjtzOjU6Im9yZGVyIjtzOjE6IjUiO3M6
NToiZmxhZ3MiO3M6MToiMCI7czo0OiJoZWxwIjtzOjEyMDA6IjxzdHlsZSB0eXBlPSJ0ZXh0
L2NzcyI+CmRpdiNhZG1pbmxpYl9oZWxwIHRkIHsgdmVydGljYWwtYWxpZ246dG9wOyB9CmRp
diNhZG1pbmxpYl9oZWxwIGNvZGUgeyBmb250LXdlaWdodDpib2xkOyBmb250OiAxMDUlLzEz
MCUgIkNvdXJpZXIgTmV3IiwgY291cmllciwgbW9ub3NwYWNlOyBiYWNrZ3JvdW5kLWNvbG9y
OiAjRkZGRkNDO30KZGl2I2FkbWlubGliX2hlbHAgY29kZS5jb2RlX3RhZyB7IGZvbnQtd2Vp
Z2h0Om5vcm1hbDsgYm9yZGVyOjFweCBkb3R0ZWQgIzk5OTsgYmFja2dyb3VuZC1jb2xvcjog
I2YwZTY4YzsgZGlzcGxheTpibG9jazsgbWFyZ2luOjEwcHggMTBweCAyMHB4OyBwYWRkaW5n
OjEwcHg7IH0KZGl2I2FkbWlubGliX2hlbHAgYTpsaW5rLCBkaXYjYWRtaW5saWJfaGVscCBh
OnZpc2l0ZWQgeyBjb2xvcjogYmx1ZTsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBib3JkZXIt
Ym90dG9tOiAxcHggc29saWQgYmx1ZTsgcGFkZGluZy1ib3R0b206MXB4O30KZGl2I2FkbWlu
bGliX2hlbHAgYTpob3ZlciwgZGl2I2FkbWlubGliX2hlbHAgYTphY3RpdmUgeyBjb2xvcjog
Ymx1ZTsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBib3JkZXItYm90dG9tOiAycHggc29saWQg
Ymx1ZTsgcGFkZGluZy1ib3R0b206MXB4O30KZGl2I2FkbWlubGliX2hlbHAgaDEgeyBjb2xv
cjogIzM2OTsgZm9udDogMjBweCBHZW9yZ2lhLCBzYW5zLXNlcmlmOyBtYXJnaW46IDA7IHRl
eHQtYWxpZ246IGNlbnRlcjsgfQpkaXYjYWRtaW5saWJfaGVscCBoMiB7IGJvcmRlci1ib3R0
b206IDFweCBzb2xpZCBibGFjazsgcGFkZGluZzoxMHB4IDAgMDsgY29sb3I6ICMzNjk7IGZv
bnQ6IDE3cHggR2VvcmdpYSwgc2Fucy1zZXJpZjsgfQpkaXYjYWRtaW5saWJfaGVscCBoMyB7
IGNvbG9yOiAjNjkzOyBmb250OiBib2xkIDEycHggQXJpYWwsIHNhbnMtc2VyaWY7IGxldHRl
ci1zcGFjaW5nOiAxcHg7IG1hcmdpbjogMTBweCAwIDA7dGV4dC10cmFuc2Zvcm06IHVwcGVy
Y2FzZTt9Cjwvc3R5bGU+Cgk8cD4KPGRpdiBpZD0iYWRtaW5saWJfaGVscCI+PC9wPgoJPGgx
IGlkPSJ0b3AiPkdyYWVtZSBQb3J0ZW91cyYjODIxNzsgQWRtaW4gTGlicmFyeS48L2gxPgoJ
PHA+UHJvdmlkZXMgYmFzaWMgY2xhc3NlcyBmb3IgYnVpbGRpbmcgdGhlIGFkbWluIHNpZGUg
b2YgeW91ciBvd24sIGRlcml2ZWQsIHBsdWdpbnMuPC9wPgoJPHA+PC9kaXY+PC9wPiI7czoz
OiJtZDUiO3M6MzI6IjYyNTcwMTIwOWMxZGUzMTExMmU4NzZlMTM5MjgxZTZjIjt9
